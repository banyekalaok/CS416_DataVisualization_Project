<!DOCTYPE html>
<html>
<head>
  <title>Connecticut County Map and Ohio Bar Charts</title>
  <meta name="description" content="Interactive visualizations using D3.js: a map of Connecticut counties, a bar chart of Ohio's population from 2010 to 2022, a bar chart of Ohio's employment from 2010 to 2022, and a bar chart of Ohio's per capita income from 2010 to 2022.">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    path {
      fill: lightblue;
      stroke: black;
    }
    .button-container {
      text-align: center;
      margin-top: 20px;
    }
    .button-container button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
    }
    .bar {
      fill: steelblue;
    }
    .bar:hover {
      fill: darkblue;
    }
    .axis-label {
      font-size: 14px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Connecticut County Map and Ohio Bar Charts</h1>
  <p>This page displays an interactive map of Connecticut counties, a bar chart of Ohio's population from 2010 to 2022, a bar chart of Ohio's employment from 2010 to 2022, and a bar chart of Ohio's per capita income from 2010 to 2022 using D3.js. Use the buttons below to switch between the visualizations.</p>

  <div id="map-container">
    <svg id="map" width="1200" height="800"></svg>
  </div>

  <div id="chart-container" class="hidden">
    <svg id="chart" width="1200" height="600"></svg>
  </div>

  <div class="button-container">
    <button id="prev-button">Prev</button>
    <button id="next-button">Next</button>
  </div>

  <script>
    // Connecticut County Map
    var mapWidth = 1200;
    var mapHeight = 800;

    var mapSvg = d3.select("#map")
                   .attr("width", mapWidth)
                   .attr("height", mapHeight);

    var projection = d3.geoMercator()
                       .center([-72.6940, 41.6032]) // Center the map on Connecticut
                       .scale(13000) // Scale the map to fit within the SVG
                       .translate([mapWidth / 2, mapHeight / 2]);

    var path = d3.geoPath().projection(projection);

    d3.json("ct-counties.geojson").then(function(data) {
      mapSvg.selectAll("path")
            .data(data.features)
            .enter().append("path")
            .attr("d", path)
            .attr("class", "county");
    }).catch(function(error) {
      console.log(error);
    });

    // Ohio Population, Employment, and Per Capita Income Bar Charts
    var chartWidth = 1200;
    var chartHeight = 600;
    var margin = {top: 40, right: 20, bottom: 40, left: 40};

    var populationData = [3580279, 3594193, 3605259, 3610314, 3614695, 3611995, 3607688, 3607615, 3611318, 3607159, 3597362, 3623355, 3626205];
    var employmentData = [2171940, 2206253, 2223243, 2246505, 2266061, 2288144, 2301331, 2300273, 2314465, 2297910, 2217432, 2289551, 2391946];
    var incomeData = [61392, 62964, 63555, 61999, 64482, 66220, 67550, 69146, 72157, 74173, 77383, 80691, 82938];
    var years = [2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022];

    var chartSvg = d3.select("#chart")
                     .attr("width", chartWidth)
                     .attr("height", chartHeight);

    var x = d3.scaleBand()
              .domain(years)
              .range([margin.left, chartWidth - margin.right])
              .padding(0.1);

    var y = d3.scaleLinear()
              .domain([3500000, 3700000]) // Initial y-axis range for population
              .nice()
              .range([chartHeight - margin.bottom, margin.top]);

    var yAxisLabel = "Population";

    chartSvg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${chartHeight - margin.bottom})`)
            .call(d3.axisBottom(x).tickSizeOuter(0))
            .append("text")
            .attr("class", "axis-label")
            .attr("x", chartWidth / 2)
            .attr("y", margin.bottom - 10)
            .attr("fill", "black")
            .attr("text-anchor", "middle")
            .text("Year");

    var yAxis = chartSvg.append("g")
                        .attr("class", "y-axis")
                        .attr("transform", `translate(${margin.left},0)`)
                        .call(d3.axisLeft(y));

    yAxis.append("text")
         .attr("class", "axis-label")
         .attr("x", -margin.left)
         .attr("y", margin.top - 10)
         .attr("fill", "black")
         .attr("text-anchor", "start")
         .text(yAxisLabel);

    var bars = chartSvg.selectAll(".bar")
                       .data(populationData)
                       .enter().append("rect")
                       .attr("class", "bar")
                       .attr("x", (d, i) => x(years[i]))
                       .attr("y", d => y(d))
                       .attr("width", x.bandwidth())
                       .attr("height", d => y(0) - y(d));

    function updateChart(newData, newLabel, newYDomain) {
      y.domain(newYDomain).nice();

      yAxis.transition()
           .duration(1000)
           .call(d3.axisLeft(y));

      yAxis.select(".axis-label")
           .text(newLabel);

      bars.data(newData)
          .transition()
          .duration(1000)
          .attr("y", d => y(d))
          .attr("height", d => y(0) - y(d));
    }

    var state = 0; // 0 for map, 1 for population chart, 2 for employment chart, 3 for income chart

    function updateVisualization() {
      if (state === 0) {
        document.getElementById('map-container').classList.remove('hidden');
        document.getElementById('chart-container').classList.add('hidden');
      } else if (state === 1) {
        document.getElementById('map-container').classList.add('hidden');
        document.getElementById('chart-container').classList.remove('hidden');
        updateChart(populationData, "Population", [3500000, 3700000]);
      } else if (state === 2) {
        document.getElementById('map-container').classList.add('hidden');
        document.getElementById('chart-container').classList.remove('hidden');
        updateChart(employmentData, "Employment", [2100000, 2400000]);
      } else if (state === 3) {
        document.getElementById('map-container').classList.add('hidden');
        document.getElementById('chart-container').classList.remove('hidden');
        updateChart(incomeData, "Per Capita Income", [60000, 85000]);
      }
    }

    // Button event listeners
    document.getElementById('prev-button').addEventListener('click', function() {
      state = (state - 1 + 4) % 4;
      updateVisualization();
    });

    document.getElementById('next-button').addEventListener('click', function() {
      state = (state + 1) % 4;
      updateVisualization();
    });

    // Initialize the visualization
    updateVisualization();
  </script>
</body>
</html>
